<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <div th:replace="common/common_css :: common_css"></div>
    <!--日期插件-->
    <link th:href="@{/bootstrap/css/daterangepicker-bs3.css}"
          href="/static/bootstrap/css/daterangepicker-bs3.css" rel="stylesheet" media="screen">
</head>

<body>
<div th:replace="pages/head :: head"></div>
<section id="main-content">
    <section class="wrapper">
        <!--page start-->
        <div id="bill_list" class="row">
            <div class="col-lg-12">
                <div class="panel">
                    <!--头部 位置显示栏-->
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"></button>
                        <h4 class="modal-title">课堂|老师 销量TopN统计</h4>
                    </div>
                    <!--头部 位置显示栏结束-->
                    <div class="row">
                        <div class="col-md-9">
                            <!--   Kitchen Sink -->
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <div>
                                        <table class="table" frame=void>
                                            <tbody>
                                            <tr>
                                                <th>排序方式</th>
                                                <th>
                                                    <select class="form-control" id="sort">
                                                        <option value="desc" checked="checked">倒序</option>
                                                        <option value="asc">正序</option>
                                                    </select></th>
                                                <th>统计类型</th>
                                                <th>
                                                    <select class="form-control" id="type">
                                                        <option value="class">课程</option>
                                                        <option value="teacher">老师</option>
                                                    </select></th>
                                            </tr>
                                            <tr>
                                                <th>开始日期</th>
                                                <th>
                                                    <div class="input-group date form_date" data-date=""
                                                         data-date-format="yyyy-MM-dd" data-link-field="dtp_input2"
                                                         data-link-format="yyyy-mm-dd">
                                                        <input class="form-control" id="begin_date" size="3"
                                                               value="2000-01-01">
                                                        <span class="input-group-addon"><span
                                                                class="glyphicon glyphicon-calendar"></span></span>
                                                    </div>
                                                </th>
                                                <th>结束日期</th>
                                                <th>
                                                    <div class="input-group date form_date" data-date=""
                                                         data-date-format="yyyy-MM-dd" data-link-field="dtp_input2"
                                                         data-link-format="yyyy-mm-dd">
                                                        <input class="form-control" id="end_date" size="3" value="">
                                                        <span class="input-group-addon"><span
                                                                class="glyphicon glyphicon-calendar"></span></span>
                                                    </div>
                                                </th>
                                                <th>结果数量N</th>
                                                <th>
                                                    <div class="input-group">
                                                        <input id="topN" type="text" class="form-control" placeholder="请输入要搜索的结果数量N...." value="10">
                                                        <span class="input-group-btn">
                                                        <button id="queryClick" class="btn btn-default" type="button">搜索</button>
                                                        </span>
                                                    </div><!-- /input-group -->
                                                </th>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- End  Kitchen Sink -->
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-1"></div>
                        <div class="col-md-10 text-center">
                            <h3>
                                <span class="nextTitle text-success"></span>
                                <button class="btn btn-success btn-xs" title="导出Excel" onclick="toexcel()"><i
                                        class="icon-download-alt">下载到Excel</i></button>
                            </h3>
                        </div>
                        <div class="col-md-1"></div>
                    </div>
                    <!-- /. ROW  -->
                    <div class="row" style="height: 20px"></div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-default">
                                <div class="panel-body" id="day_div">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered table-hover" id="classTable">
                                            <thead>
                                                <tr>
                                                    <th id="table_h1">课堂id</th>
                                                    <th id="table_h2">课堂title</th>
                                                    <th id="table_h3">销量</th>
                                                </tr>
                                            </thead>
                                            <tbody>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- End  Kitchen Sink -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- page end-->
    </section>
</section>


<!--引入js 文件-->
<script th:src="@{/bootstrap/js/jquery.dataTables.min.js}" src="/static/bootstrap/js/jquery.dataTables.min.js"></script>
<script th:src="@{/bootstrap/js/DT_bootstrap.js}" src="/static/bootstrap/js/DT_bootstrap.js"></script>
<script th:src="@{/bootstrap/js/moment.js}" src="/static/bootstrap/js/moment.js"></script>
<script th:src="@{/bootstrap/js/daterangepicker.js}" src="/static/bootstrap/js/daterangepicker.js"></script>
<div th:replace="common/common_js :: common_js"></div>
<script th:src="@{/bootstrap/js/bootstrap-datetimepicker.min.js}"
        src="/static/bootstrap/js/bootstrap-datetimepicker.min.js" charset="UTF-8"></script>
<script th:src="@{/bootstrap/js/bootstrap-datetimepicker.zh-CN.js}"
        src="/static/bootstrap/js/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>


<script type="text/javascript">
    //日期插件使用
    $('.form_date').datetimepicker({
        language: 'zh-CN',
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0
    });

    window.onload = function () {
        $("#end_date").attr("value", getNowFormatDate);
    };

    /**
     * 填充结束日期
     */
    function getNowFormatDate() {
        var date = new Date();
        var seperator1 = "-";
        var year = date.getFullYear();
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var currentdate = year + seperator1 + month + seperator1 + strDate;
        return currentdate;
    }


    $("#queryClick").click(function () {
        getNextDate();
    });


    function getNextDate() {
        //$('#myModal').modal('show');


        var sort = $("#sort").val();
        var type = $("#type").val();
        var begin_date = $("#begin_date").val();
        var end_date = $("#end_date").val();
        var topN = $("#topN").val();
        $.get("/class/queryTopN/" + type +  "", {
            beginDate: begin_date,
            endDate: end_date,
            sort: sort,
            topN: topN
        }, function (msg) {
            //设置标题
            $(".nextTitle").html(msg.nextTitle);
            classAndTeacherChange(type);
            //设置表格
            var sexHtml = showSelectNext(msg.tablejson);
            $("#classTable tr:not(:first)").empty();
            $("#classTable").append(sexHtml);

            //$('#myModal').modal('hide');
        });

    }

    /**
     * 渲染表格内容数据
     * @param data
     * @returns {*}
     */
    function showSelectNext(data) {
        var html;
        $.each(data, function (i, item) {
            html += "<tr>" +
                "<td>" + item.classId + "</td>" +
                "<td>" + item.title + "</td>" +
                "<td>" + item.sales + "</td>" +
                "<tr>";
        });
        return html;
    }

    function classAndTeacherChange(type) {
        if(type === 'class'){
            $("#table_h1").html("课堂id");
            $("#table_h2").html("课堂title");
            $("#table_h3").html("销售量");
        }
        if(type === 'teacher'){
            $("#table_h1").html("老师id");
            $("#table_h2").html("老师昵称");
            $("#table_h3").html("销售数量");
        }
    }

    /**
     * 表格数据下载excel
     */
    function toexcel() {
        var crowd = $("#crowd").val();
        var parentType = $("#mySelect").val();
        var type = $("#selectNext").val();
        var begin_date = $("#begin_date").val();
        var end_date = $("#end_date").val();
        var isLogin = 0;
        var flag = 0;
        if ($("#is_login").is(":checked")) {//选中
            isLogin = 1;
        }
        if ($("#is_flag").is(":checked")) {//选中
            flag = 1;
        }
        window.location.href = "/exportExcel/" + crowd + "/" + parentType + "/" + type + "? beginDate=" + begin_date + "&endDate=" + end_date + "&isLogin=" + isLogin + "&flag=" + flag + "";
    }
</script>


</body>
</html>

